(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d22c6f5"],{f2e8:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mt-8"},[a("v-alert",{staticStyle:{position:"absolute",top:"16px","z-index":"4"},attrs:{type:e.alertType,dismissible:"",transition:"slide-x-transition"},model:{value:e.alert,callback:function(t){e.alert=t},expression:"alert"}},[e._v(e._s(e.alertMsg))]),a("v-btn",{attrs:{color:"primary",text:""},on:{click:function(){return e.$router.go(-1)}}},[a("v-icon",{attrs:{left:""}},[e._v(" mdi-chevron-left ")]),e._v(" Wróć ")],1),a("p",{staticClass:"text-h4 mt-8"},[e._v("Dodaj miejsce")]),a("v-form",{ref:"form",model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[a("v-select",{attrs:{items:e.categories,label:"Kategoria *",rules:e.rules},model:{value:e.placeLocal.category,callback:function(t){e.$set(e.placeLocal,"category",t)},expression:"placeLocal.category"}}),a("v-text-field",{staticClass:"mt-5",attrs:{label:"Tytuł *",hint:"Nazwa pod jaką inni będą mogli wszyukiwać podane miejsce",rules:e.rules},model:{value:e.placeLocal.title,callback:function(t){e.$set(e.placeLocal,"title",t)},expression:"placeLocal.title"}}),a("v-textarea",{staticClass:"mt-5",attrs:{label:"Opis *",hint:"Krótki opis podanego miejsca",rules:e.rules},model:{value:e.placeLocal.description,callback:function(t){e.$set(e.placeLocal,"description",t)},expression:"placeLocal.description"}}),a("p",{staticClass:"text-subtitle-1 mb-0 mt-4"},[e._v(" Dodaj zdjęcia lub przeciągnij na pole ")]),a("div",{on:{dragover:e.dragover,dragleave:e.dragleave,drop:e.drop}},[a("v-file-input",{ref:"imginput",attrs:{accept:"image/png, image/jpeg, image/bmp, image/img","prepend-icon":"mdi-camera",chips:"",multiple:"",label:"Zdjęcia",rules:e.imageRules},on:{change:e.onAddFiles},model:{value:e.images,callback:function(t){e.images=t},expression:"images"}})],1),0!==e.attachments.length||0!==e.imagesUrls.length?a("v-row",{staticClass:"pa-3"},[e._l(e.attachments,(function(t,n){return a("v-img",{key:"attachment-"+n,staticClass:"mr-3",attrs:{"max-height":"100","max-width":"160",src:t.image}},[a("v-spacer"),a("v-btn",{attrs:{fab:"","x-small":"",color:"primary"},on:{click:function(t){return e.removeFile(n,"attachments")}}},[a("v-icon",{attrs:{dark:""}},[e._v(" mdi-minus ")])],1)],1)})),e._l(e.imagesUrls,(function(t,n){return a("v-img",{key:"image-"+n,staticClass:"mr-3",attrs:{"max-height":"100","max-width":"160",src:t}},[a("v-spacer"),a("v-btn",{attrs:{fab:"","x-small":"",color:"primary"},on:{click:function(t){return e.removeFile(n,"imagesUrls")}}},[a("v-icon",{attrs:{dark:""}},[e._v(" mdi-minus ")])],1)],1)}))],2):e._e()],1),a("p",{staticClass:"text-subtitle-1 mb-0 mt-4"},[e._v("Podaj lokalizację miejsca")]),a("localization-select",{ref:"localizationselect",attrs:{localization:e.placeLocal.localization}}),a("v-row",{staticClass:"justify-end mb-5"},[a("v-btn",{attrs:{color:"error mr-2"},on:{click:e.deletePost}},[e._v("usuń")]),a("v-btn",{attrs:{color:"primary lighten-1"},on:{click:e.addPost}},[e._v("Zapisz")])],1)],1)},r=[],i=a("2909"),o=a("5530"),c=a("1da1"),s=(a("96cf"),a("d3b7"),a("159b"),a("b0c0"),a("caad"),a("2532"),a("ac1f"),a("1276"),a("a434"),a("b64b"),a("99af"),a("498a"),a("3ca3"),a("ddb0"),a("2b3d"),a("9861"),a("a630"),a("24e5")),l=a("5a19"),p={components:{LocalizationSelect:l["a"]},props:{title:{type:String,default:function(){return null}},place:{type:Object,default:function(){return null}}},data:function(){var e=this;return{valid:!1,attachments:[],attachmentsToRemove:[],placeLocal:{},imagesUrls:[],convertedImages:[],categories:["Punkt widokowy","Odpoczynek","Aktywny wypoczynek"],images:[],allowedTypes:"image/png, image/jpeg, image/bmp, image/img",imageRules:[function(e){var t=!1,a=[];return e.forEach((function(e){a.some((function(t){return t.name==e.name}))&&(t=!0),a.push(e)})),!t||"Dodano już podany plik"},function(t){return!t||!t.some((function(t){return!e.allowedTypes.includes(t.type)}))||"Podano niewłaściwy format pliku. Dopuszczalne formaty: png, jpg, jpeg, bmp, img"}],rules:[function(e){return!!e||"Pole wymagane"}],alert:!1,alertMsg:"Coś poszło nie tak! Spróbuj ponownie.",alertType:"error"}},created:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(window.scrollTo(0,0),!e.place){t.next=7;break}return e.placeLocal=e.place,t.next=5,s["a"].get("/api/attachments/?post=".concat(e.place.id)).then((function(t){e.attachments=t.data}));case 5:t.next=9;break;case 7:return t.next=9,s["a"].get("/api/postretive?id=".concat(e.title.split("-").pop())).then((function(t){e.placeLocal=t.data[0],s["a"].get("/api/attachments/?post=".concat(t.data[0].id)).then((function(t){e.attachments=t.data}))}));case 9:case"end":return t.stop()}}),t)})))()},methods:{removeFile:function(e,t){"attachments"===t&&this.attachmentsToRemove.push(this.attachments[e].id),this[t].splice(e,1),this.convertedImages.splice(e,1),this.images.splice(e,1)},deletePost:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,s["a"].delete("/api/post/".concat(e.placeLocal.id)).then((function(){e.alertMsg="Pomyślnie usunięto miejsce",e.alert=!0,e.alertType="success",setTimeout((function(){e.alert=!1}),5e3),e.$router.go(-1)})).catch((function(){e.alertMsg="Coś poszło nie tak. Spróbuj ponownie",e.alert=!0,e.alertType="error",setTimeout((function(){e.alert=!1}),5e3)}));case 2:case"end":return t.stop()}}),t)})))()},addPost:function(){var e=this;if(this.$refs.form.validate(),this.valid&&this.$refs.localizationselect.markerLabel){var t=this.preprareFromData();this.convertedImages.forEach((function(e){t.append("images",e,e.name)})),s["a"].post("/api/post",t,{headers:Object(o["a"])(Object(o["a"])({},s["a"].headers),{},{"content-type":"multipart/form-data"})}).then((function(){window.scrollTo(0,0),e.alertMsg="Pomyślnie edytowano miejsce",e.alert=!0,e.alertType="success",setTimeout((function(){e.alert=!1}),5e3)})).catch((function(){e.alertMsg="Coś poszło nie tak. Spróbuj ponownie",e.alert=!0,e.alertType="error",setTimeout((function(){e.alert=!1}),5e3)}))}else this.alertMsg="Uzupełnij barkujące pola i spróbuj ponownie",this.alert=!0,this.alertType="error",setTimeout((function(){e.alert=!1}),5e3)},preprareFromData:function(){var e=this,t=new FormData,a=this.$refs.localizationselect.markerLabel;t.append("localization",this.$refs.localizationselect.markerLatLng),Object.keys(this.placeLocal).forEach((function(a){return t.append(a,e.placeLocal[a])})),t.append("attachmentsToRemove",this.attachmentsToRemove),t.append("country",a.country),t.append("post_code",a.postcode),t.append("state",a.state),t.append("city",a.city||a.village||a.town);var n="".concat(a.road||""," ").concat(a.house_number||"");return t.append("street",n.trim()),t},onAddFiles:function(e){var t=this;0==e.length&&(this.convertedImages=[]),e.forEach((function(e){var a=new FileReader;a.readAsArrayBuffer(e);var n=t;a.onload=function(e){var t=new Blob([e.target.result]),a=URL.createObjectURL(t);n.imagesUrls.push(a);var r=new Image;r.src=a,r.onload=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=n.resizeMe(r),e.next=3,fetch(t).then((function(e){return e.blob()})).then((function(e){return new File([e],n.imgName()+".jpg",{type:"image/jpeg"})}));case 3:a=e.sent,n.convertedImages.push(a);case 5:case"end":return e.stop()}}),e)})))}}))},resizeMe:function(e){var t=document.createElement("canvas"),a=e.width,n=e.height,r=800,i=800;a>n?a>r&&(n=Math.round(n*=r/a),a=r):n>i&&(a=Math.round(a*=i/n),n=i),t.width=a,t.height=n;var o=t.getContext("2d");return o.drawImage(e,0,0,a,n),t.toDataURL("image/jpeg",.8)},imgName:function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=t.length,n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*a));return e},dragover:function(e){e.preventDefault(),this.$refs.imginput.focus()},dragleave:function(e){e.preventDefault(),this.$refs.imginput.blur()},drop:function(e){var t;e.preventDefault(),this.onAddFiles(Array.from(e.dataTransfer.files)),(t=this.images).push.apply(t,Object(i["a"])(e.dataTransfer.files)),this.$refs.imginput.validate()}}},u=p,m=a("2877"),d=a("6544"),f=a.n(d),g=a("0798"),h=a("8336"),v=a("23a7"),b=a("4bd4"),w=a("132d"),y=a("adda"),k=a("0fd9"),j=a("b974"),x=a("2fa4"),z=a("8654"),T=a("a844"),L=Object(m["a"])(u,n,r,!1,null,"dc0e6406",null);t["default"]=L.exports;f()(L,{VAlert:g["a"],VBtn:h["a"],VFileInput:v["a"],VForm:b["a"],VIcon:w["a"],VImg:y["a"],VRow:k["a"],VSelect:j["a"],VSpacer:x["a"],VTextField:z["a"],VTextarea:T["a"]})}}]);
//# sourceMappingURL=chunk-2d22c6f5.93a0d6cd.js.map